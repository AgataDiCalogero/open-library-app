<div class="min-h-dvh bg-paper bg-gradient-to-b from-paper via-wash/40 to-paper">
  <div class="mx-auto w-full max-w-7xl space-y-6 px-4 py-8 sm:px-6 lg:px-8">
    <header class="space-y-3">
      <p class="text-xs font-semibold uppercase tracking-[0.24em] text-brand">Open Library</p>
      <div class="space-y-1">
        <h1 class="text-2xl font-semibold text-ink sm:text-3xl">Browse by subject</h1>
        <p class="text-sm text-ink/70">
          Discover curated shelves and keep loading more titles as you explore.
        </p>
      </div>
    </header>

    <div class="space-y-6 lg:space-y-7">
      <app-search-bar
        [resetToken]="searchResetToken()"
        (searched)="onSearchFromInput($event)"
      />

      <section class="space-y-3 pt-3 lg:pt-4">
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-ink/60">Popular subjects</p>
        <div class="flex flex-wrap gap-2">
          @for (chip of popularSubjects; track chip) {
          <button
            type="button"
            class="chip chip--interactive"
            [class.chip--active]="subject() === chip"
            [class.chip--inactive]="subject() !== chip"
            [attr.aria-pressed]="subject() === chip"
            (click)="onSearchFromChip(chip)"
          >
            {{ formatSubjectLabel(chip) }}
          </button>
          }
        </div>
      </section>
    </div>

    @if (total() !== null) {
    <div class="rounded-2xl border border-ink/10 bg-white/70 px-4 py-2 text-sm text-ink/70">
      Showing {{ booksAccumulated().length }} of {{ total() }}
    </div>
    }

    @if (isInitialLoading()) {
    <div class="space-y-3">
      <div class="animate-pulse rounded-2xl border border-ink/10 bg-white/80 p-4 shadow-sm">
        <div class="flex gap-3">
          <div class="h-20 w-14 rounded-lg bg-wash/70"></div>
          <div class="flex-1 space-y-2">
            <div class="h-3 w-3/4 rounded bg-ink/10"></div>
            <div class="h-3 w-1/2 rounded bg-ink/10"></div>
          </div>
        </div>
      </div>
      <div class="animate-pulse rounded-2xl border border-ink/10 bg-white/80 p-4 shadow-sm">
        <div class="flex gap-3">
          <div class="h-20 w-14 rounded-lg bg-wash/70"></div>
          <div class="flex-1 space-y-2">
            <div class="h-3 w-4/5 rounded bg-ink/10"></div>
            <div class="h-3 w-2/5 rounded bg-ink/10"></div>
          </div>
        </div>
      </div>
      <div class="animate-pulse rounded-2xl border border-ink/10 bg-white/80 p-4 shadow-sm">
        <div class="flex gap-3">
          <div class="h-20 w-14 rounded-lg bg-wash/70"></div>
          <div class="flex-1 space-y-2">
            <div class="h-3 w-2/3 rounded bg-ink/10"></div>
            <div class="h-3 w-1/3 rounded bg-ink/10"></div>
          </div>
        </div>
      </div>
    </div>
    } @else {
    @if (booksAccumulated().length === 0 && total() !== null) {
    <div class="rounded-2xl border border-ink/10 bg-white/80 p-6 text-sm shadow-sm">
      <p class="font-medium text-ink">No books found.</p>
      <p class="mt-1 text-ink/60">Try another subject or check your spelling.</p>
    </div>
    } @else {
    <app-book-list [books]="booksAccumulated()" (selectBook)="onOpenBook($event)" />
    }
    }

    @if (canLoadMore()) {
    <div class="flex justify-center pt-2">
      <button
        type="button"
        class="inline-flex items-center gap-2 rounded-full bg-brand px-6 py-2 text-sm font-semibold text-paper shadow-sm transition hover:opacity-90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/30 focus-visible:ring-offset-2 focus-visible:ring-offset-paper disabled:cursor-not-allowed disabled:opacity-70"
        [disabled]="isLoadingMore()"
        (click)="loadMore()"
      >
        Load more
        @if (isLoadingMore()) {
        <span
          class="inline-flex h-4 w-4 animate-spin rounded-full border-2 border-paper/60 border-t-paper"
        ></span>
        }
      </button>
    </div>
    }
  </div>
</div>
